<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CasinoMax - Online Casino Platform</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Mobile Menu Toggle Button -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    
    <div class="app-container">
        <!-- Left Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-crown"></i>
                </div>
                <div class="logo-text">CasinoMax</div>
            </div>
            
            <nav class="nav-menu">
                <a href="#" class="nav-item active" onclick="showHome()">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <a href="#" class="nav-item" id="favorites-nav">
                    <i class="fas fa-star"></i>
                    <span>Favorites</span>
                </a>
                <a href="#" class="nav-item" id="community-nav">
                    <i class="fas fa-users"></i>
                    <span>Community</span>
                </a>
                <a href="#" class="nav-item" onclick="showProfile(); console.log('Profile clicked!'); return false;">
                    <i class="fas fa-user"></i>
                    <span>Profile</span>
                </a>
            </nav>
            
            <div class="user-profile" id="userProfile">
                <div class="user-avatar" id="userAvatar">C</div>
                <div class="user-info">
                    <div class="user-name" id="userName">Charlie Brown</div>
                    <div class="user-balance" id="userBalance">$3000</div>
                </div>
                <div class="user-actions">
                    <button class="admin-btn" id="adminBtn" onclick="goToAdmin()" title="Admin Dashboard" style="display: none;">
                        <i class="fas fa-chart-line"></i>
                    </button>
                    <button class="logout-btn" id="logoutBtn" onclick="window.location.href='login.html';" title="Logout">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
            
            <div class="auth-buttons" id="authButtons" style="display: none;">
                <a href="login.html" class="btn btn-primary">Login</a>
                <a href="register.html" class="btn btn-secondary">Register</a>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Topbar (UI only) -->
            <div class="topbar">
                <div class="brand">CasinoMax</div>
                <div class="balance"><span class="label">Balance</span><span class="amount">$6,785.50</span></div>
            </div>
            <!-- Top Banners -->
            <div class="banners" style="display:flex;gap:20px;align-items:stretch;">
                <div class="banner welcome-banner" style="flex:1 1 0;min-width:0;">
                    <div class="banner-icon">
                        <i class="fas fa-gift"></i>
                    </div>
                    <div class="banner-content">
                        <h3>Welcome Bonus</h3>
                        <p>Get 200% Bonus Up to $2,000 + 50 Free Spins on your first deposit</p>
                        <button class="btn btn-primary">Claim Now</button>
                    </div>
                </div>
                
                <div class="banner vip-banner" style="flex:1 1 0;min-width:0;">
                    <div class="banner-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="banner-content">
                        <h3>VIP Program</h3>
                        <p>Join Elite Club - Exclusive rewards, personal manager, and premium benefits</p>
                        <button class="btn btn-secondary">Learn More</button>
                    </div>
                </div>
            </div>
            
            <!-- Recent Wins Section -->
            <div class="section">
                <div class="section-header">
                    <h2><i class="fas fa-trophy"></i> Recent Wins</h2>
                </div>
                <div class="slider-container">
                    <div class="wins-slider" id="wins-slider">
                        <div class="no-games-message">
                            <div class="no-games-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <h3>No Recent Wins</h3>
                            <p>Recent wins will appear here once players start winning!</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Slots Section -->
            <div class="section">
                <div class="section-header">
                    <h2><i class="fas fa-bolt"></i> Slots</h2>
                </div>
                <div class="slider-container">
                    <div class="games-slider" id="slots-slider">
                        <!-- Games will be loaded dynamically from admin panel -->
                        <div class="no-games-message">
                            <div class="no-games-icon">
                                <i class="fas fa-gamepad"></i>
                            </div>
                            <h3>No Games Available</h3>
                            <p>Games will be added by the admin team. Check back soon for exciting casino games!</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Roulette Section -->
            <div class="section">
                <div class="section-header">
                    <h2><i class="fas fa-circle"></i> Roulette</h2>
                </div>
                <div class="slider-container">
                    <div class="games-slider" id="roulette-slider">
                        <div class="no-games-message">
                            <div class="no-games-icon">
                                <i class="fas fa-gamepad"></i>
                            </div>
                            <h3>No Games Available</h3>
                            <p>Games will be added by the admin team. Check back soon for exciting casino games!</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Profile Section -->
            <div id="profile-section" style="display: none; position: fixed; top: 0; left: 200px; right: 300px; bottom: 0; z-index: 1000; background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%); color: white; padding: 30px; overflow-y: auto;">
                <div class="profile-container" style="max-width: 1200px; margin: 0 auto;">
                    <!-- Profile Header -->
                    <div class="profile-header" style="background: linear-gradient(135deg, rgba(39, 174, 96, 0.2) 0%, rgba(46, 204, 113, 0.1) 100%); border: 1px solid rgba(39, 174, 96, 0.3); border-radius: 15px; padding: 30px; margin-bottom: 30px; text-align: center; position: relative; overflow: hidden;">
                        <div style="position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.05), transparent); animation: shimmer 3s infinite;"></div>
                        <div class="profile-avatar-large" style="width: 120px; height: 120px; background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 48px; color: white; box-shadow: 0 10px 30px rgba(39, 174, 96, 0.3); position: relative;">
                            <i class="fas fa-user" id="profileAvatarIcon"></i>
                            <div class="status-dot" style="position: absolute; bottom: 10px; right: 10px; width: 20px; height: 20px; background: #2ecc71; border: 3px solid #0f0f23; border-radius: 50%; animation: pulse 2s infinite;"></div>
                        </div>
                        <h1 style="color: #2ecc71; font-size: 32px; margin-bottom: 10px; text-shadow: 0 2px 4px rgba(0,0,0,0.3);" id="profileName">Guest User</h1>
                        <p style="color: #bdc3c7; font-size: 18px; margin-bottom: 20px;" id="profileEmail">guest@example.com</p>
                        <div class="profile-level" style="display: inline-block; background: linear-gradient(135deg, #e67e22 0%, #f39c12 100%); color: white; padding: 8px 20px; border-radius: 25px; font-weight: bold; box-shadow: 0 4px 15px rgba(230, 126, 34, 0.3);">
                            <i class="fas fa-star" style="margin-right: 8px;"></i>Level 1 Player
                        </div>
                    </div>

                    <!-- Profile Stats Grid -->
                    <div class="profile-stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <!-- Balance Card -->
                        <div class="stat-card" style="background: linear-gradient(135deg, rgba(52, 73, 94, 0.8) 0%, rgba(44, 62, 80, 0.9) 100%); border: 1px solid rgba(39, 174, 96, 0.3); border-radius: 15px; padding: 25px; text-align: center; position: relative; overflow: hidden;">
                            <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #27ae60, #2ecc71, #58d68d);"></div>
                            <div class="stat-icon" style="font-size: 32px; color: #2ecc71; margin-bottom: 15px;">
                                <i class="fas fa-wallet"></i>
                            </div>
                            <div class="stat-value" style="font-size: 28px; font-weight: bold; color: #2ecc71; margin-bottom: 5px;" id="profileBalance">$0.00</div>
                            <div class="stat-label" style="color: #bdc3c7; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;">Account Balance</div>
                            <div style="margin-top: 20px;">
                                <button class="btn btn-success" onclick="addBalance()" style="margin-right: 10px; margin-bottom: 10px;">
                                    <i class="fas fa-plus"></i> Add Funds
                                </button>
                                <button class="btn btn-secondary" onclick="withdrawBalance()" style="margin-bottom: 10px;">
                                    <i class="fas fa-minus"></i> Withdraw
                                </button>
                            </div>
                        </div>

                        <!-- Games Played Card -->
                        <div class="stat-card" style="background: linear-gradient(135deg, rgba(52, 73, 94, 0.8) 0%, rgba(44, 62, 80, 0.9) 100%); border: 1px solid rgba(39, 174, 96, 0.3); border-radius: 15px; padding: 25px; text-align: center; position: relative; overflow: hidden;">
                            <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #e67e22, #f39c12, #f1c40f);"></div>
                            <div class="stat-icon" style="font-size: 32px; color: #f39c12; margin-bottom: 15px;">
                                <i class="fas fa-gamepad"></i>
                            </div>
                            <div class="stat-value" style="font-size: 28px; font-weight: bold; color: #f39c12; margin-bottom: 5px;" id="gamesPlayed">0</div>
                            <div class="stat-label" style="color: #bdc3c7; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;">Games Played</div>
                        </div>

                        <!-- Win Rate Card -->
                        <div class="stat-card" style="background: linear-gradient(135deg, rgba(52, 73, 94, 0.8) 0%, rgba(44, 62, 80, 0.9) 100%); border: 1px solid rgba(39, 174, 96, 0.3); border-radius: 15px; padding: 25px; text-align: center; position: relative; overflow: hidden;">
                            <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #9b59b6, #8e44ad, #af7ac5);"></div>
                            <div class="stat-icon" style="font-size: 32px; color: #9b59b6; margin-bottom: 15px;">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="stat-value" style="font-size: 28px; font-weight: bold; color: #9b59b6; margin-bottom: 5px;" id="winRate">0%</div>
                            <div class="stat-label" style="color: #bdc3c7; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;">Win Rate</div>
                        </div>

                        <!-- Total Winnings Card -->
                        <div class="stat-card" style="background: linear-gradient(135deg, rgba(52, 73, 94, 0.8) 0%, rgba(44, 62, 80, 0.9) 100%); border: 1px solid rgba(39, 174, 96, 0.3); border-radius: 15px; padding: 25px; text-align: center; position: relative; overflow: hidden;">
                            <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #e74c3c, #c0392b, #ec7063);"></div>
                            <div class="stat-icon" style="font-size: 32px; color: #e74c3c; margin-bottom: 15px;">
                                <i class="fas fa-coins"></i>
                            </div>
                            <div class="stat-value" style="font-size: 28px; font-weight: bold; color: #e74c3c; margin-bottom: 5px;" id="totalWinnings">$0.00</div>
                            <div class="stat-label" style="color: #bdc3c7; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;">Total Winnings</div>
                        </div>
                    </div>

                    <!-- Personal Information & Actions -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                        <!-- Personal Information -->
                        <div class="info-card" style="background: linear-gradient(135deg, rgba(52, 73, 94, 0.8) 0%, rgba(44, 62, 80, 0.9) 100%); border: 1px solid rgba(39, 174, 96, 0.3); border-radius: 15px; padding: 25px;">
                            <h3 style="color: #2ecc71; margin-bottom: 20px; font-size: 20px; display: flex; align-items: center;">
                                <i class="fas fa-user-circle" style="margin-right: 10px;"></i> Personal Information
                            </h3>
                            <div class="info-item" style="margin-bottom: 15px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                                <div style="color: #2ecc71; font-weight: bold; margin-bottom: 5px;">Full Name</div>
                                <div style="color: #ecf0f1;" id="profileName">Guest User</div>
                            </div>
                            <div class="info-item" style="margin-bottom: 15px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                                <div style="color: #2ecc71; font-weight: bold; margin-bottom: 5px;">Email Address</div>
                                <div style="color: #ecf0f1;" id="profileEmail">guest@example.com</div>
                            </div>
                            <div class="info-item" style="margin-bottom: 15px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                                <div style="color: #2ecc71; font-weight: bold; margin-bottom: 5px;">Phone Number</div>
                                <div style="color: #ecf0f1;" id="profilePhone">Not provided</div>
                            </div>
                            <div class="info-item" style="margin-bottom: 15px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                                <div style="color: #2ecc71; font-weight: bold; margin-bottom: 5px;">Country</div>
                                <div style="color: #ecf0f1;" id="profileCountry">Not specified</div>
                            </div>
                            <div class="info-item" style="padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                                <div style="color: #2ecc71; font-weight: bold; margin-bottom: 5px;">Member Since</div>
                                <div style="color: #ecf0f1;" id="memberSince">Today</div>
                            </div>
                        </div>

                        <!-- Account Actions -->
                        <div class="actions-card" style="background: linear-gradient(135deg, rgba(52, 73, 94, 0.8) 0%, rgba(44, 62, 80, 0.9) 100%); border: 1px solid rgba(39, 174, 96, 0.3); border-radius: 15px; padding: 25px; position: relative; overflow: hidden;">
                            <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #2ecc71, #27ae60, #58d68d);"></div>
                            <h3 style="color: #2ecc71; margin-bottom: 25px; font-size: 22px; display: flex; align-items: center; font-weight: bold; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">
                                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);">
                                    <i class="fas fa-cog" style="color: white; font-size: 18px;"></i>
                                </div>
                                Account Actions
                            </h3>
                            <div style="display: grid; gap: 18px;">
                                <button class="btn btn-primary" id="editProfileBtn" onclick="editProfile()" style="width: 100%; padding: 18px 20px; font-size: 16px; border-radius: 12px; background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); border: none; color: white; font-weight: bold; box-shadow: 0 6px 20px rgba(39, 174, 96, 0.3); transition: all 0.3s ease; position: relative; overflow: hidden;">
                                    <div style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); transition: left 0.5s ease;"></div>
                                    <i class="fas fa-edit" style="margin-right: 12px; font-size: 18px;"></i> Edit Profile
                                </button>
                                <button class="btn btn-info" onclick="changePassword()" style="width: 100%; padding: 18px 20px; font-size: 16px; border-radius: 12px; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); border: none; color: white; font-weight: bold; box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3); transition: all 0.3s ease; position: relative; overflow: hidden;">
                                    <div style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); transition: left 0.5s ease;"></div>
                                    <i class="fas fa-key" style="margin-right: 12px; font-size: 18px;"></i> Change Password
                                </button>
                                <button class="btn btn-warning" onclick="viewTransactionHistory()" style="width: 100%; padding: 18px 20px; font-size: 16px; border-radius: 12px; background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); border: none; color: white; font-weight: bold; box-shadow: 0 6px 20px rgba(243, 156, 18, 0.3); transition: all 0.3s ease; position: relative; overflow: hidden;">
                                    <div style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); transition: left 0.5s ease;"></div>
                                    <i class="fas fa-history" style="margin-right: 12px; font-size: 18px;"></i> Transaction History
                                </button>
                                <button class="btn btn-danger" onclick="clearUserDataAndReset()" style="width: 100%; padding: 18px 20px; font-size: 16px; border-radius: 12px; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); border: none; color: white; font-weight: bold; box-shadow: 0 6px 20px rgba(231, 76, 60, 0.3); transition: all 0.3s ease; position: relative; overflow: hidden;">
                                    <div style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); transition: left 0.5s ease;"></div>
                                    <i class="fas fa-trash" style="margin-right: 12px; font-size: 18px;"></i> Reset Account
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Edit Profile Form (Hidden by default) -->
                    <div id="profileForm" style="display: none; background: linear-gradient(135deg, rgba(52, 73, 94, 0.8) 0%, rgba(44, 62, 80, 0.9) 100%); border: 1px solid rgba(39, 174, 96, 0.3); border-radius: 15px; padding: 30px; margin-top: 30px;">
                        <h3 style="color: #2ecc71; margin-bottom: 25px; font-size: 24px; display: flex; align-items: center;">
                            <i class="fas fa-edit" style="margin-right: 15px;"></i> Edit Profile Information
                        </h3>
                        <form id="editProfileForm" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label style="color: #2ecc71; display: block; margin-bottom: 8px; font-weight: bold;">First Name</label>
                                <input type="text" id="editFirstName" name="firstName" required style="width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid rgba(39, 174, 96, 0.3); color: white; border-radius: 8px; font-size: 16px;">
                            </div>
                            <div class="form-group">
                                <label style="color: #2ecc71; display: block; margin-bottom: 8px; font-weight: bold;">Last Name</label>
                                <input type="text" id="editLastName" name="lastName" required style="width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid rgba(39, 174, 96, 0.3); color: white; border-radius: 8px; font-size: 16px;">
                            </div>
                            <div class="form-group">
                                <label style="color: #2ecc71; display: block; margin-bottom: 8px; font-weight: bold;">Email Address</label>
                                <input type="email" id="editEmail" name="email" required style="width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid rgba(39, 174, 96, 0.3); color: white; border-radius: 8px; font-size: 16px;">
                            </div>
                            <div class="form-group">
                                <label style="color: #2ecc71; display: block; margin-bottom: 8px; font-weight: bold;">Phone Number</label>
                                <input type="tel" id="editPhone" name="phone" style="width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid rgba(39, 174, 96, 0.3); color: white; border-radius: 8px; font-size: 16px;">
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label style="color: #2ecc71; display: block; margin-bottom: 8px; font-weight: bold;">Country</label>
                                <select id="editCountry" name="country" style="width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid rgba(39, 174, 96, 0.3); color: white; border-radius: 8px; font-size: 16px;">
                                    <option value="">Select Country</option>
                                    <option value="US">United States</option>
                                    <option value="CA">Canada</option>
                                    <option value="UK">United Kingdom</option>
                                    <option value="AU">Australia</option>
                                    <option value="DE">Germany</option>
                                    <option value="FR">France</option>
                                    <option value="ES">Spain</option>
                                    <option value="IT">Italy</option>
                                    <option value="NL">Netherlands</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="form-actions" style="grid-column: 1 / -1; display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                                <button type="button" class="btn btn-secondary" onclick="cancelEditProfile()" style="padding: 15px 30px; font-size: 16px; border-radius: 10px;">
                                    <i class="fas fa-times" style="margin-right: 8px;"></i> Cancel
                                </button>
                                <button type="submit" class="btn btn-primary" style="padding: 15px 30px; font-size: 16px; border-radius: 10px;">
                                    <i class="fas fa-save" style="margin-right: 8px;"></i> Save Changes
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Right Chat Sidebar -->
        <div class="chat-sidebar" id="chat-sidebar">
            <div class="chat-header">
                <h3><i class="fas fa-comments"></i> Global Chat</h3>
                <div class="chat-actions">
                    <div class="online-count">1,247 online</div>
                </div>
            </div>
            
            <div class="chat-messages">
                <div class="chat-message">
                    <div class="message-avatar casino-king">C</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-user">CasinoKing</span>
                            <span class="message-time">2:34 PM</span>
                        </div>
                        <div class="message-text">
                            Just hit the jackpot on Mega Fortune! $15,240
                            <span class="win-badge">Win!</span>
                        </div>
                    </div>
                </div>
                
                <div class="chat-message">
                    <div class="message-avatar lucky-player">L</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-user">LuckyPlayer</span>
                            <span class="message-time">2:32 PM</span>
                        </div>
                        <div class="message-text">Anyone playing roulette tonight?</div>
                    </div>
                </div>
                
                <div class="chat-message">
                    <div class="message-avatar slot-master">S</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-user">SlotMaster</span>
                            <span class="message-time">2:30 PM</span>
                        </div>
                        <div class="message-text">The new Dragon's Gold slot is amazing! ðŸ”¥</div>
                    </div>
                </div>
                
                <div class="chat-message">
                    <div class="message-avatar vegas-vibes">V</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-user">VegasVibes</span>
                            <span class="message-time">2:28 PM</span>
                        </div>
                        <div class="message-text">
                            Big win on blackjack! Lady luck is with me tonight $2,850
                            <span class="win-badge">Win!</span>
                        </div>
                    </div>
                </div>
                
                <div class="chat-message">
                    <div class="message-avatar roulette-pro">R</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-user">RoulettePro</span>
                            <span class="message-time">2:25 PM</span>
                        </div>
                        <div class="message-text">Red or black? What's your prediction?</div>
                    </div>
                </div>
            </div>
            
            <div class="chat-input">
                <input type="text" placeholder="Type your message..." class="message-input">
                <button class="send-button">
                    <i class="fas fa-question"></i>
                </button>
            </div>
        </div>
        
        <!-- Profile Modal -->
        <div class="profile-modal-overlay" id="profileModalOverlay" style="display: none;">
            <div class="profile-modal">
                <div class="profile-modal-header">
                    <h2 id="profileModalName">Profile</h2>
                    <button class="profile-modal-close" onclick="closeProfileModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="profile-modal-content">
                    <div class="profile-avatar-section">
                        <div class="profile-avatar-large" id="profileModalAvatar">A</div>
                        <div class="profile-status" id="profileModalStatus">
                            <span class="status-dot" id="profileModalStatusDot"></span>
                            <span id="profileModalStatusText">Online</span>
                        </div>
                    </div>
                    
                    <div class="profile-stats-grid">
                        <div class="stat-item">
                            <div class="stat-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value" id="profileModalLevel">15</div>
                                <div class="stat-label">Level</div>
                            </div>
                        </div>
                        
                        <div class="stat-item">
                            <div class="stat-icon">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value" id="profileModalBalance">$2,500</div>
                                <div class="stat-label">Balance</div>
                            </div>
                        </div>
                        
                        <div class="stat-item">
                            <div class="stat-icon">
                                <i class="fas fa-gamepad"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value" id="profileModalGames">1,247</div>
                                <div class="stat-label">Games Played</div>
                            </div>
                        </div>
                        
                        <div class="stat-item">
                            <div class="stat-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value" id="profileModalWinRate">68%</div>
                                <div class="stat-label">Win Rate</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="profile-actions">
                        <button class="btn btn-primary" onclick="messageFromProfile()">
                            <i class="fas fa-comment"></i> Message
                        </button>
                        <button class="btn btn-outline" onclick="closeProfileModal()">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Floating Chat Toggle Button (always visible) -->
        <div class="floating-chat-toggle" id="floating-chat-toggle">
            <button class="btn btn-primary" id="floating-chat-btn" title="Show/Hide Chat">
                <i class="fas fa-comments"></i>
            </button>
        </div>
    </div>
    
    <script src="database-init.js" defer></script>
    <script src="security.js" defer></script>
    </div>
    
    <script src="visitor-tracking.js" defer></script>
    <script src="script.js" defer></script>
    
    <!-- EMERGENCY CHAT TOGGLE FIX -->
    <script>
        // This will definitely work - direct implementation
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== EMERGENCY CHAT TOGGLE SETUP ===');
            
            // EMERGENCY PROFILE TAB FIX
            console.log('=== EMERGENCY PROFILE TAB SETUP ===');
            setTimeout(function() {
                const profileNav = document.querySelector('[onclick*="showProfile"]');
                if (profileNav) {
                    console.log('Profile nav found, adding backup click handler');
                    profileNav.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('Profile tab clicked via backup handler');
                        
                        // Hide all main content sections
                        const mainContent = document.querySelector('.main-content');
                        if (mainContent) {
                            const children = mainContent.children;
                            for (let i = 0; i < children.length; i++) {
                                const child = children[i];
                                if (child.id !== 'profile-section') {
                                    child.style.display = 'none';
                                }
                            }
                        }
                        
                        // Show profile section
                        const profileSection = document.getElementById('profile-section');
                        if (profileSection) {
                            profileSection.style.display = 'block';
                            profileSection.classList.add('profile-visible');
                            console.log('Profile section shown via backup handler');
                            
                            // Load profile data
                            if (typeof loadProfileData === 'function') {
                                loadProfileData();
                            } else {
                                console.log('loadProfileData function not found, using fallback');
                                // Fallback: just show some basic profile info
                                const profileName = document.getElementById('profileName');
                                const profileEmail = document.getElementById('profileEmail');
                                const profileBalance = document.getElementById('profileBalance');
                                
                                if (profileName) profileName.textContent = 'Guest User';
                                if (profileEmail) profileEmail.textContent = 'guest@example.com';
                                if (profileBalance) profileBalance.textContent = '$0.00';
                            }
                        }
                        
                        // Update navigation
                        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                        profileNav.classList.add('active');
                    });
                }
            }, 100);
            
            // Add test function to window for debugging
            window.testProfileTab = function() {
                console.log('Testing Profile tab...');
                const profileSection = document.getElementById('profile-section');
                if (profileSection) {
                    profileSection.style.display = 'block';
                    profileSection.classList.add('profile-visible');
                    console.log('Profile section should now be visible');
                    return true;
                } else {
                    console.error('Profile section not found');
                    return false;
                }
            };
            
            // Add function to check user data
            window.checkUserData = function() {
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                const token = localStorage.getItem('token');
                console.log('Current user data:', user);
                console.log('Token exists:', !!token);
                return { user, token: !!token };
            };
            
            // Add function to set test user data
            window.setTestUser = function() {
                const testUser = {
                    name: 'Charlie Brown',
                    email: 'charlie@example.com',
                    balance: 3000,
                    firstName: 'Charlie',
                    lastName: 'Brown',
                    avatar: null
                };
                localStorage.setItem('user', JSON.stringify(testUser));
                localStorage.setItem('token', 'test-token');
                console.log('Test user data set:', testUser);
                return testUser;
            };
            
            // Add function to manually sync sidebar
            window.syncSidebar = function() {
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                const userName = document.getElementById('userName');
                const userBalance = document.getElementById('userBalance');
                const userAvatar = document.getElementById('userAvatar');
                
                if (userName) userName.textContent = user.name || 'User';
                if (userBalance) userBalance.textContent = `$${user.balance || 0}`;
                if (userAvatar) {
                    if (user.avatar) {
                        userAvatar.innerHTML = `<img src="${user.avatar}" alt="Avatar" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
                    } else {
                        userAvatar.textContent = (user.name || 'U').charAt(0).toUpperCase();
                    }
                }
                
                console.log('Sidebar synced with user data:', user);
                return user;
            };
            
            // Add function to manually show Profile section
            window.showProfileSection = function() {
                console.log('Manually showing Profile section...');
                
                // Hide all other sections
                const mainContent = document.querySelector('.main-content');
                if (mainContent) {
                    const children = mainContent.children;
                    for (let i = 0; i < children.length; i++) {
                        const child = children[i];
                        if (child.id !== 'profile-section') {
                            child.style.display = 'none';
                        }
                    }
                }
                
                // Show profile section
                const profileSection = document.getElementById('profile-section');
                if (profileSection) {
                    profileSection.style.display = 'block';
                    profileSection.classList.add('profile-visible');
                    console.log('Profile section should now be visible');
                    return true;
                } else {
                    console.error('Profile section not found');
                    return false;
                }
            };
            
            // Add simple test functions that will definitely work
            window.testProfile = function() {
                console.log('Testing Profile...');
                showOnlyProfile();
                console.log('Profile should be visible now');
            };
            
            window.testHome = function() {
                console.log('Testing Home...');
                showOnlyHome();
                console.log('Home should be visible now');
            };
            
            window.testCommunity = function() {
                console.log('Testing Community...');
                showOnlyCommunity();
                console.log('Community should be visible now');
            };
            
            window.testFavorites = function() {
                console.log('Testing Favorites...');
                showOnlyFavorites();
                console.log('Favorites should be visible now');
            };
            
            window.testHideAll = function() {
                console.log('Testing Hide All...');
                hideAllSections();
                console.log('All sections should be hidden now');
            };
            
            // Test the new Profile system
            window.testNewProfile = function() {
                console.log('Testing NEW Profile system...');
                showOnlyProfile();
                console.log('Profile should be created and visible now');
            };
            
            // Emergency profile test
            window.forceProfile = function() {
                console.log('FORCING profile to show...');
                const profileSection = document.getElementById('profile-section');
                if (profileSection) {
                    profileSection.style.display = 'block';
                    console.log('Profile section forced to show');
                } else {
                    console.error('Profile section not found in HTML!');
                }
            };
            
            // Simple profile test
            window.testProfileSimple = function() {
                console.log('Testing simple profile...');
                const profileSection = document.getElementById('profile-section');
                if (profileSection) {
                    console.log('Profile section found:', profileSection);
                    profileSection.style.display = 'block';
                    profileSection.style.visibility = 'visible';
                    profileSection.classList.add('show');
                    console.log('Profile should be visible now');
                } else {
                    console.error('Profile section not found!');
                }
            };
            
            // Emergency profile fix
            window.fixProfile = function() {
                console.log('Fixing profile display...');
                const profileSection = document.getElementById('profile-section');
                if (profileSection) {
                    profileSection.style.cssText = 'display: block !important; visibility: visible !important; opacity: 1 !important; background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%) !important; color: white !important; padding: 30px !important; min-height: 100vh !important;';
                    console.log('Profile FORCED to show with full styling');
                } else {
                    console.error('Profile section not found!');
                }
            };
            
            // Nuclear option - completely rebuild profile
            window.nuclearProfile = function() {
                console.log('Nuclear option - rebuilding profile...');
                const mainContent = document.querySelector('.main-content');
                if (mainContent) {
                    // Hide everything
                    Array.from(mainContent.children).forEach(child => {
                        child.style.display = 'none';
                    });
                    
                    // Show profile with force
                    const profileSection = document.getElementById('profile-section');
                    if (profileSection) {
                        profileSection.style.cssText = 'display: block !important; visibility: visible !important; opacity: 1 !important;';
                        console.log('Profile section should be visible now');
                    }
                }
            };
            
            // Test navigation separation
            window.testNavigation = function() {
                console.log('Testing navigation separation...');
                console.log('Click Home tab - should hide profile');
                console.log('Click Profile tab - should show profile');
                console.log('Click Community tab - should hide profile');
                console.log('Click Favorites tab - should hide profile');
            };
            
            // Simple functions for profile actions
            window.changePassword = function() {
                // Create and show the change password modal
                const modal = document.createElement('div');
                modal.id = 'changePasswordModal';
                modal.innerHTML = `
                    <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.8); z-index: 10000; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(5px);">
                        <div style="background: linear-gradient(135deg, rgba(52, 73, 94, 0.95) 0%, rgba(44, 62, 80, 0.95) 100%); border: 2px solid rgba(52, 152, 219, 0.5); border-radius: 20px; padding: 40px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5); position: relative;">
                            <button onclick="closeChangePasswordModal()" style="position: absolute; top: 15px; right: 15px; background: transparent; border: none; color: #3498db; font-size: 28px; cursor: pointer; padding: 0; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s ease;">&times;</button>
                            
                            <h2 style="color: #3498db; margin: 0 0 30px 0; font-size: 28px; display: flex; align-items: center;">
                                <i class="fas fa-key" style="margin-right: 12px; font-size: 32px;"></i>
                                Change Password
                            </h2>
                            
                            <form id="changePasswordForm" style="display: flex; flex-direction: column; gap: 20px;">
                                <div>
                                    <label style="color: #3498db; display: block; margin-bottom: 8px; font-weight: bold; font-size: 14px;">Current Password</label>
                                    <input type="password" id="currentPassword" required style="width: 100%; padding: 15px; background: rgba(0, 0, 0, 0.3); border: 2px solid rgba(52, 152, 219, 0.3); color: white; border-radius: 10px; font-size: 16px; transition: all 0.3s ease;" onfocus="this.style.borderColor='#3498db'; this.style.boxShadow='0 0 10px rgba(52, 152, 219, 0.3)';" onblur="this.style.borderColor='rgba(52, 152, 219, 0.3)'; this.style.boxShadow='none';" placeholder="Enter current password">
                                </div>
                                
                                <div>
                                    <label style="color: #3498db; display: block; margin-bottom: 8px; font-weight: bold; font-size: 14px;">New Password</label>
                                    <input type="password" id="newPassword" required style="width: 100%; padding: 15px; background: rgba(0, 0, 0, 0.3); border: 2px solid rgba(52, 152, 219, 0.3); color: white; border-radius: 10px; font-size: 16px; transition: all 0.3s ease;" onfocus="this.style.borderColor='#3498db'; this.style.boxShadow='0 0 10px rgba(52, 152, 219, 0.3)';" onblur="this.style.borderColor='rgba(52, 152, 219, 0.3)'; this.style.boxShadow='none';" placeholder="Enter new password">
                                    <div style="color: #bdc3c7; font-size: 12px; margin-top: 5px;">
                                        <i class="fas fa-info-circle"></i> Must be at least 8 characters
                                    </div>
                                </div>
                                
                                <div>
                                    <label style="color: #3498db; display: block; margin-bottom: 8px; font-weight: bold; font-size: 14px;">Confirm New Password</label>
                                    <input type="password" id="confirmNewPassword" required style="width: 100%; padding: 15px; background: rgba(0, 0, 0, 0.3); border: 2px solid rgba(52, 152, 219, 0.3); color: white; border-radius: 10px; font-size: 16px; transition: all 0.3s ease;" onfocus="this.style.borderColor='#3498db'; this.style.boxShadow='0 0 10px rgba(52, 152, 219, 0.3)';" onblur="this.style.borderColor='rgba(52, 152, 219, 0.3)'; this.style.boxShadow='none';" placeholder="Confirm new password">
                                </div>
                                
                                <div style="display: flex; gap: 15px; margin-top: 10px;">
                                    <button type="button" onclick="closeChangePasswordModal()" style="flex: 1; padding: 15px; background: rgba(231, 76, 60, 0.2); border: 2px solid rgba(231, 76, 60, 0.5); color: #e74c3c; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(231, 76, 60, 0.3)';" onmouseout="this.style.background='rgba(231, 76, 60, 0.2)';">
                                        Cancel
                                    </button>
                                    <button type="submit" style="flex: 1; padding: 15px; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); border: none; color: white; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(52, 152, 219, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 20px rgba(52, 152, 219, 0.3)';">
                                        <i class="fas fa-save" style="margin-right: 8px;"></i> Update Password
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Handle form submission
                document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    window.submitPasswordChange();
                });
            };
            
            window.closeChangePasswordModal = function() {
                const modal = document.getElementById('changePasswordModal');
                if (modal) {
                    modal.remove();
                }
            };
            
            window.submitPasswordChange = function() {
                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmNewPassword').value;
                
                // Validation
                if (!currentPassword || !newPassword || !confirmPassword) {
                    alert('Please fill in all fields');
                    return;
                }
                
                if (newPassword.length < 8) {
                    alert('New password must be at least 8 characters long');
                    return;
                }
                
                if (newPassword !== confirmPassword) {
                    alert('New passwords do not match');
                    return;
                }
                
                if (newPassword === currentPassword) {
                    alert('New password must be different from current password');
                    return;
                }
                
                // Simulate password change (in real app, would send to backend)
                console.log('Password change submitted:', {
                    currentPassword: '***',
                    newPassword: '***'
                });
                
                // Show success message
                closeChangePasswordModal();
                alert('Password changed successfully!');
                
                // In real app, you would:
                // 1. Send currentPassword and newPassword to backend
                // 2. Verify currentPassword
                // 3. Update password in database
                // 4. Log user out and ask them to login again
            };
            
            window.viewTransactionHistory = function() {
                if (typeof openTransactionHistoryModal === 'function') {
                    openTransactionHistoryModal();
                } else {
                    alert('Transaction History feature coming soon!');
                }
            };
            
            window.cancelEditProfile = function() {
                const form = document.getElementById('profileForm');
                if (form) {
                    form.style.display = 'none';
                }
            };
            
            // Add backup navigation handlers for all tabs
            setTimeout(function() {
                // Profile tab
                const profileNav = document.querySelector('[onclick*="showProfile"]');
                if (profileNav) {
                    profileNav.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('Profile tab clicked via backup handler');
                        
                        // Show profile section - wait for functions to be available
                        setTimeout(function() {
                            if (typeof showProfile === 'function') {
                                showProfile();
                            } else {
                                // Fallback: hide all and FORCE show profile with fixed positioning
                                if (typeof hideAllSections === 'function') hideAllSections();
                                const profileSection = document.getElementById('profile-section');
                                if (profileSection) {
                                    profileSection.removeAttribute('hidden');
                                    profileSection.style.cssText = 'display: block !important; visibility: visible !important; opacity: 1 !important; position: fixed !important; top: 0 !important; left: 200px !important; right: 300px !important; bottom: 0 !important; z-index: 1000 !important; background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%) !important; color: white !important; padding: 30px !important; overflow-y: auto !important;';
                                    console.log('Profile FORCED to show via fallback');
                                }
                            }
                        }, 100);

                        // Load profile data
                        if (typeof loadProfileData === 'function') {
                            loadProfileData();
                        }

                        // Update navigation
                        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                        profileNav.classList.add('active');
                    });
                }
                
                // Home tab
                const homeNav = document.querySelector('[onclick*="showHome"]');
                if (homeNav) {
                    homeNav.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('Home tab clicked via backup handler');
                        
                        // FORCE HIDE profile section
                        const profileSection = document.getElementById('profile-section');
                        if (profileSection) {
                            profileSection.style.cssText = 'display: none !important; visibility: hidden !important; opacity: 0 !important; position: fixed !important; top: -9999px !important; left: -9999px !important; z-index: -9999 !important; pointer-events: none !important;';
                            profileSection.setAttribute('hidden', 'true');
                            console.log('Profile section FORCE HIDDEN from home tab');
                        }
                        
                        // Hide all sections first
                        if (typeof hideAllSections === 'function') {
                            hideAllSections();
                        }
                        
                        // Show home content
                        const mainContent = document.querySelector('.main-content');
                        if (mainContent) {
                            const children = mainContent.children;
                            for (let i = 0; i < children.length; i++) {
                                const child = children[i];
                                if (!child.id || (!child.id.includes('section') && !child.id.includes('profile'))) {
                                    child.style.display = 'block';
                                    child.style.visibility = 'visible';
                                    child.style.opacity = '1';
                                }
                            }
                        }
                        
                        // Update navigation
                        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                        homeNav.classList.add('active');
                    });
                }
                
                // Favorites tab
                const favoritesNav = document.getElementById('favorites-nav');
                if (favoritesNav) {
                    favoritesNav.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('Favorites tab clicked via backup handler');
                        
                        // Hide all sections first
                        if (typeof hideAllSections === 'function') {
                            hideAllSections();
                        }
                        
                        // Show favorites section
                        if (typeof showFavorites === 'function') {
                            showFavorites();
                        }
                        
                        // Update navigation
                        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                        favoritesNav.classList.add('active');
                    });
                }
                
                // Community tab
                const communityNav = document.getElementById('community-nav');
                if (communityNav) {
                    communityNav.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('Community tab clicked via backup handler');
                        
                        // Hide all sections first
                        if (typeof hideAllSections === 'function') {
                            hideAllSections();
                        }
                        
                        // Show community section
                        if (typeof showCommunity === 'function') {
                            showCommunity();
                        }
                        
                        // Update navigation
                        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                        communityNav.classList.add('active');
                    });
                }
            }, 100);
            
            // Add backup event listeners for profile functions
            setTimeout(function() {
                const editProfileBtn = document.getElementById('editProfileBtn');
                if (editProfileBtn) {
                    editProfileBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('Edit Profile button clicked via backup handler');
                        if (typeof editProfile === 'function') {
                            editProfile();
                        } else {
                            console.log('editProfile function not found, using fallback');
                            const profileForm = document.getElementById('profileForm');
                            if (profileForm) {
                                profileForm.style.display = 'block';
                                editProfileBtn.style.display = 'none';
                            }
                        }
                    });
                }
            }, 200);
            
            // Add backup handlers for Add Funds and Withdraw buttons
            setTimeout(function() {
                const addFundsBtn = document.querySelector('[onclick="addBalance()"]');
                const withdrawBtn = document.querySelector('[onclick="withdrawBalance()"]');
                
                if (addFundsBtn) {
                    addFundsBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('Add Funds button clicked');
                        const amount = prompt('Enter amount to add to your balance:');
                        if (amount && !isNaN(amount) && parseFloat(amount) > 0) {
                            const user = JSON.parse(localStorage.getItem('user') || '{}');
                            const currentBalance = parseFloat(user.balance || 0);
                            const newBalance = currentBalance + parseFloat(amount);
                            
                            user.balance = newBalance;
                            localStorage.setItem('user', JSON.stringify(user));
                            
                            // Update display - both profile and sidebar
                            const profileBalance = document.getElementById('profileBalance');
                            const userBalance = document.getElementById('userBalance');
                            
                            if (profileBalance) profileBalance.textContent = `$${newBalance}`;
                            if (userBalance) userBalance.textContent = `$${newBalance}`;
                            
                            console.log('Balance updated via backup handler:', newBalance);
                            alert(`Successfully added $${amount} to your balance!`);
                        }
                    });
                }
                
                if (withdrawBtn) {
                    withdrawBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('Withdraw button clicked');
                        const user = JSON.parse(localStorage.getItem('user') || '{}');
                        const currentBalance = parseFloat(user.balance || 0);
                        
                        if (currentBalance <= 0) {
                            alert('Insufficient balance for withdrawal');
                            return;
                        }
                        
                        const amount = prompt(`Enter amount to withdraw (Available: $${currentBalance}):`);
                        if (amount && !isNaN(amount) && parseFloat(amount) > 0 && parseFloat(amount) <= currentBalance) {
                            const newBalance = currentBalance - parseFloat(amount);
                            
                            user.balance = newBalance;
                            localStorage.setItem('user', JSON.stringify(user));
                            
                            // Update display - both profile and sidebar
                            const profileBalance = document.getElementById('profileBalance');
                            const userBalance = document.getElementById('userBalance');
                            
                            if (profileBalance) profileBalance.textContent = `$${newBalance}`;
                            if (userBalance) userBalance.textContent = `$${newBalance}`;
                            
                            console.log('Balance updated via backup handler:', newBalance);
                            alert(`Successfully withdrew $${amount} from your balance!`);
                        }
                    });
                }
            }, 300);
            
            // Add backup form submission handler for profile editing
            setTimeout(function() {
                const editProfileForm = document.getElementById('editProfileForm');
                if (editProfileForm) {
                    editProfileForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        console.log('Profile form submitted via backup handler');
                        
                        // Get form data
                        const formData = new FormData(editProfileForm);
                        const user = JSON.parse(localStorage.getItem('user') || '{}');
                        
                        // Update user data
                        user.firstName = formData.get('firstName') || user.firstName;
                        user.lastName = formData.get('lastName') || user.lastName;
                        user.email = formData.get('email') || user.email;
                        user.phone = formData.get('phone') || user.phone;
                        user.dateOfBirth = formData.get('dateOfBirth') || user.dateOfBirth;
                        user.country = formData.get('country') || user.country;
                        user.name = `${user.firstName} ${user.lastName}`.trim();
                        
                        console.log('Updated user data:', user);
                        
                        // Save to localStorage
                        localStorage.setItem('user', JSON.stringify(user));
                        
                        // Update profile display
                        const profileName = document.getElementById('profileName');
                        const profileEmail = document.getElementById('profileEmail');
                        if (profileName) profileName.textContent = user.name;
                        if (profileEmail) profileEmail.textContent = user.email;
                        
                        // Update sidebar display
                        const userName = document.getElementById('userName');
                        const userBalance = document.getElementById('userBalance');
                        const userAvatar = document.getElementById('userAvatar');
                        
                        if (userName) userName.textContent = user.name;
                        if (userBalance) userBalance.textContent = `$${user.balance || 0}`;
                        if (userAvatar) {
                            if (user.avatar) {
                                userAvatar.innerHTML = `<img src="${user.avatar}" alt="Avatar" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
                            } else {
                                userAvatar.textContent = user.name.charAt(0).toUpperCase();
                            }
                        }
                        
                        // Hide form and show edit button
                        const profileForm = document.getElementById('profileForm');
                        const editProfileBtn = document.getElementById('editProfileBtn');
                        if (profileForm) profileForm.style.display = 'none';
                        if (editProfileBtn) editProfileBtn.style.display = 'inline-flex';
                        
                        alert('Profile updated successfully!');
                        console.log('Profile updated and sidebar synced');
                    });
                }
            }, 400);
            
            setTimeout(function() {
                const floatingToggle = document.getElementById('floating-chat-btn');
                const chatSidebar = document.getElementById('chat-sidebar');
                const mainContent = document.querySelector('.main-content');
                
                console.log('Emergency setup - Elements found:', {
                    floatingToggle: !!floatingToggle,
                    chatSidebar: !!chatSidebar,
                    mainContent: !!mainContent
                });
                
                if (floatingToggle && chatSidebar && mainContent) {
                    let chatVisible = true;
                    
                    // Remove any existing event listeners
                    floatingToggle.onclick = null;
                    
                    // Add direct click handler
                    floatingToggle.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        console.log('EMERGENCY CHAT TOGGLE CLICKED! State:', chatVisible);
                        
                        chatVisible = !chatVisible;
                        
                        if (chatVisible) {
                            // Show chat
                            chatSidebar.style.display = 'flex';
                            chatSidebar.classList.remove('hidden');
                            mainContent.classList.remove('chat-hidden');
                            floatingToggle.innerHTML = '<i class="fas fa-comments"></i>';
                            floatingToggle.title = 'Hide Chat';
                            console.log('EMERGENCY: Chat shown');
                        } else {
                            // Hide chat
                            chatSidebar.style.display = 'none';
                            chatSidebar.classList.add('hidden');
                            mainContent.classList.add('chat-hidden');
                            floatingToggle.innerHTML = '<i class="fas fa-eye"></i>';
                            floatingToggle.title = 'Show Chat';
                            console.log('EMERGENCY: Chat hidden');
                        }
                    });
                    
                    console.log('EMERGENCY chat toggle setup complete!');
                } else {
                    console.error('EMERGENCY: Missing elements for chat toggle');
                }
            }, 1000);
        });
    </script>
    
    <!-- SIMPLE FAVORITES NAVIGATION FIX -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== SETTING UP FAVORITES NAVIGATION ===');
            
            // Wait for everything to load
            setTimeout(function() {
                const favoritesNav = document.getElementById('favorites-nav');
                console.log('Favorites nav found:', !!favoritesNav);
                
                if (favoritesNav) {
                    // Simple click handler
                    favoritesNav.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('FAVORITES CLICKED!');
                        
                        // Hide all main content
                        const mainContent = document.querySelector('.main-content');
                        if (mainContent) {
                            const children = mainContent.children;
                            for (let i = 0; i < children.length; i++) {
                                children[i].style.display = 'none';
                            }
                        }
                        
                        // Create or show favorites section
                        let favoritesSection = document.getElementById('favorites-section');
                        if (!favoritesSection) {
                            favoritesSection = document.createElement('div');
                            favoritesSection.id = 'favorites-section';
                            favoritesSection.className = 'section';
                            favoritesSection.innerHTML = `
                                <div class="section-header">
                                    <h2><i class="fas fa-star"></i> My Favorites</h2>
                                </div>
                                <div class="favorites-container">
                                    <div class="no-favorites-message">
                                        <div class="no-favorites-icon">
                                            <i class="fas fa-star"></i>
                                        </div>
                                        <h3>No Favorites Yet</h3>
                                        <p>Games you favorite will appear here. Start exploring and add games to your favorites!</p>
                                        <button class="btn btn-primary" id="browse-games-btn">
                                            <i class="fas fa-gamepad"></i> Browse Games
                                        </button>
                                    </div>
                                </div>
                            `;
                            mainContent.appendChild(favoritesSection);
                        }
                        
                        // Show favorites section
                        favoritesSection.style.display = 'block';
                        
                        // Update navigation active state
                        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                        favoritesNav.classList.add('active');
                        
                        console.log('FAVORITES PAGE SHOWN!');
                        
                        // Set up Browse Games button after creating the section
                        setTimeout(function() {
                            const browseBtn = document.getElementById('browse-games-btn');
                            if (browseBtn) {
                                browseBtn.addEventListener('click', function(e) {
                                    e.preventDefault();
                                    console.log('BROWSE GAMES BUTTON CLICKED!');
                                    
                                    // Hide favorites section
                                    const favoritesSection = document.getElementById('favorites-section');
                                    if (favoritesSection) {
                                        favoritesSection.style.display = 'none';
                                    }
                                    
                                    // Show home content
                                    const mainContent = document.querySelector('.main-content');
                                    if (mainContent) {
                                        const children = mainContent.children;
                                        for (let i = 0; i < children.length; i++) {
                                            const child = children[i];
                                            if (child.id !== 'favorites-section' && child.id !== 'profile-section') {
                                                child.style.display = 'block';
                                                console.log('Showing home element:', child.className || child.tagName);
                                            }
                                        }
                                    }
                                    
                                    // Update navigation to show Home as active
                                    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                                    const homeNav = document.querySelector('[onclick="showHome()"]');
                                    if (homeNav) {
                                        homeNav.classList.add('active');
                                    }
                                    
                                    console.log('REDIRECTED TO HOMEPAGE!');
                                });
                                console.log('Browse Games button setup complete!');
                            } else {
                                console.error('Browse Games button not found!');
                            }
                        }, 100);
                    });
                    
                    console.log('Favorites navigation setup complete!');
                } else {
                    console.error('Favorites nav element not found!');
                }
            }, 1000);
        });
    </script>
    
    <!-- SIMPLE COMMUNITY NAVIGATION FIX -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== SETTING UP COMMUNITY NAVIGATION ===');
            
            // Wait for everything to load
            setTimeout(function() {
                const communityNav = document.getElementById('community-nav');
                console.log('Community nav found:', !!communityNav);
                
                if (communityNav) {
                    // Simple click handler
                    communityNav.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('COMMUNITY CLICKED!');
                        
                        // Hide all main content
                        const mainContent = document.querySelector('.main-content');
                        if (mainContent) {
                            const children = mainContent.children;
                            for (let i = 0; i < children.length; i++) {
                                children[i].style.display = 'none';
                            }
                        }
                        
                        // Create or show community section
                        let communitySection = document.getElementById('community-section');
                        if (!communitySection) {
                            communitySection = document.createElement('div');
                            communitySection.id = 'community-section';
                            communitySection.className = 'section';
                            communitySection.innerHTML = `
                                    <div class="section-header">
                                        <h2><i class="fas fa-users"></i> Community</h2>
                                    </div>
                                <div class="community-container">
                                    <!-- Friends Section -->
                                    <div class="friends-section">
                                        <div class="section-subheader">
                                            <h3><i class="fas fa-user-friends"></i> My Friends</h3>
                                            <span class="friend-count">3 friends</span>
                                        </div>
                                        <div class="friends-list">
                                            <div class="friend-card">
                                                <div class="friend-avatar">A</div>
                                                <div class="friend-info">
                                                    <h4>Alice Johnson</h4>
                                                    <p class="friend-status online">Online</p>
                                                    <p class="friend-level">Level 15 â€¢ $2,500</p>
                                                </div>
                                                <div class="friend-actions">
                                       <button class="btn btn-sm btn-outline" onclick="openPersonalChat('Alice Johnson', 'A')">
                                           <i class="fas fa-comment"></i>
                                       </button>
                                                    <button class="btn btn-sm btn-outline" onclick="showProfileModal('Alice Johnson', 'A', 'Online', 15, 2500, 1247, 68, 23)">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div class="friend-card">
                                                <div class="friend-avatar">B</div>
                                                <div class="friend-info">
                                                    <h4>Bob Smith</h4>
                                                    <p class="friend-status offline">Offline</p>
                                                    <p class="friend-level">Level 8 â€¢ $1,200</p>
                                                </div>
                                                <div class="friend-actions">
                                                    <button class="btn btn-sm btn-outline" onclick="openPersonalChat('Bob Smith', 'B')">
                                                        <i class="fas fa-comment"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-outline" onclick="showProfileModal('Bob Smith', 'B', 'Offline', 8, 1200, 456, 45, 12)">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div class="friend-card">
                                                <div class="friend-avatar">D</div>
                                                <div class="friend-info">
                                                    <h4>Diana Prince</h4>
                                                    <p class="friend-status online">Online</p>
                                                    <p class="friend-level">Level 22 â€¢ $5,800</p>
                                                </div>
                                                <div class="friend-actions">
                                                    <button class="btn btn-sm btn-outline" onclick="openPersonalChat('Diana Prince', 'D')">
                                                        <i class="fas fa-comment"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-outline" onclick="showProfileModal('Diana Prince', 'D', 'Online', 22, 5800, 2156, 72, 45)">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Friend Suggestions Section -->
                                    <div class="suggestions-section">
                                        <div class="section-subheader">
                                            <h3><i class="fas fa-user-plus"></i> Suggested Friends</h3>
                                            <span class="suggestion-count">5 suggestions</span>
                                        </div>
                                        <div class="suggestions-list">
                                            <div class="suggestion-card">
                                                <div class="suggestion-avatar">E</div>
                                                <div class="suggestion-info">
                                                    <h4>Eve Wilson</h4>
                                                    <p class="suggestion-reason">Mutual friends: Alice, Diana</p>
                                                    <p class="suggestion-level">Level 12 â€¢ $3,200</p>
                                                </div>
                                                <div class="suggestion-actions">
                                                    <button class="btn btn-sm btn-primary" id="add-eve" onclick="sendFriendRequest(this, 'Eve Wilson')">
                                                        <i class="fas fa-user-plus"></i> Add
                                                    </button>
                                                    <button class="btn btn-sm btn-outline" onclick="showProfileModal('Eve Wilson', 'E', 'Online', 12, 3200, 892, 58, 18)">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div class="suggestion-card">
                                                <div class="suggestion-avatar">F</div>
                                                <div class="suggestion-info">
                                                    <h4>Frank Miller</h4>
                                                    <p class="suggestion-reason">Similar gaming interests</p>
                                                    <p class="suggestion-level">Level 18 â€¢ $4,100</p>
                                                </div>
                                                <div class="suggestion-actions">
                                                    <button class="btn btn-sm btn-primary" id="add-frank" onclick="sendFriendRequest(this, 'Frank Miller')">
                                                        <i class="fas fa-user-plus"></i> Add
                                                    </button>
                                                    <button class="btn btn-sm btn-outline" onclick="showProfileModal('Frank Miller', 'F', 'Online', 18, 4100, 1456, 63, 31)">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div class="suggestion-card">
                                                <div class="suggestion-avatar">G</div>
                                                <div class="suggestion-info">
                                                    <h4>Grace Lee</h4>
                                                    <p class="suggestion-reason">Active in same tournaments</p>
                                                    <p class="suggestion-level">Level 25 â€¢ $7,500</p>
                                                </div>
                                                <div class="suggestion-actions">
                                                    <button class="btn btn-sm btn-primary" id="add-grace" onclick="sendFriendRequest(this, 'Grace Lee')">
                                                        <i class="fas fa-user-plus"></i> Add
                                                    </button>
                                                    <button class="btn btn-sm btn-outline" onclick="showProfileModal('Grace Lee', 'G', 'Online', 25, 7500, 2890, 75, 67)">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div class="suggestion-card">
                                                <div class="suggestion-avatar">H</div>
                                                <div class="suggestion-info">
                                                    <h4>Henry Davis</h4>
                                                    <p class="suggestion-reason">Recently joined community</p>
                                                    <p class="suggestion-level">Level 6 â€¢ $800</p>
                                                </div>
                                                <div class="suggestion-actions">
                                                    <button class="btn btn-sm btn-primary" id="add-henry" onclick="sendFriendRequest(this, 'Henry Davis')">
                                                        <i class="fas fa-user-plus"></i> Add
                                                    </button>
                                                    <button class="btn btn-sm btn-outline" onclick="showProfileModal('Henry Davis', 'H', 'Offline', 6, 800, 234, 42, 8)">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div class="suggestion-card">
                                                <div class="suggestion-avatar">I</div>
                                                <div class="suggestion-info">
                                                    <h4>Ivy Chen</h4>
                                                    <p class="suggestion-reason">High-level player in your region</p>
                                                    <p class="suggestion-level">Level 30 â€¢ $12,000</p>
                                                </div>
                                                <div class="suggestion-actions">
                                                    <button class="btn btn-sm btn-primary" id="add-ivy" onclick="sendFriendRequest(this, 'Ivy Chen')">
                                                        <i class="fas fa-user-plus"></i> Add
                                                    </button>
                                                    <button class="btn btn-sm btn-outline" onclick="showProfileModal('Ivy Chen', 'I', 'Online', 30, 12000, 3456, 78, 89)">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Community Stats -->
                                    <div class="community-stats">
                                        <div class="stat-card">
                                            <div class="stat-icon">
                                                <i class="fas fa-users"></i>
                                            </div>
                                            <div class="stat-info">
                                                <h3>1,247</h3>
                                                <p>Active Players</p>
                                            </div>
                                        </div>
                                        <div class="stat-card">
                                            <div class="stat-icon">
                                                <i class="fas fa-trophy"></i>
                                            </div>
                                            <div class="stat-info">
                                                <h3>89</h3>
                                                <p>Tournaments</p>
                                            </div>
                                        </div>
                                        <div class="stat-card">
                                            <div class="stat-icon">
                                                <i class="fas fa-comments"></i>
                                            </div>
                                            <div class="stat-info">
                                                <h3>2,156</h3>
                                                <p>Messages Today</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                            mainContent.appendChild(communitySection);
                        }
                        
                        // Show community section
                        communitySection.style.display = 'block';
                        
                        // Update navigation active state
                        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                        communityNav.classList.add('active');
                        
                        console.log('COMMUNITY PAGE SHOWN!');
                    });
                    
                    console.log('Community navigation setup complete!');
                } else {
                    console.error('Community nav element not found!');
                }
            }, 1000);
        });
    </script>
    
    <script>
        function openPersonalChat(friendName, friendInitial) {
            console.log('=== OPENING PERSONAL CHAT ===');
            console.log('Friend:', friendName);
            console.log('Initial:', friendInitial);
            
            // Get the chat sidebar
            const chatSidebar = document.getElementById('chat-sidebar');
            console.log('Chat sidebar found:', !!chatSidebar);
            
            if (!chatSidebar) {
                alert('ERROR: Chat sidebar not found!');
                return;
            }
            
            // Show the chat sidebar
            chatSidebar.style.display = 'flex';
            chatSidebar.style.visibility = 'visible';
            chatSidebar.style.opacity = '1';
            chatSidebar.classList.remove('hidden');
            console.log('Chat sidebar should now be visible');
            
            // Update the chat header
            const chatHeader = chatSidebar.querySelector('.chat-header h3');
            console.log('Chat header found:', !!chatHeader);
            if (chatHeader) {
                chatHeader.innerHTML = '<i class="fas fa-comment"></i> Chat with ' + friendName;
                console.log('Chat header updated');
            }
            
            // Update the online count
            const onlineCount = chatSidebar.querySelector('.online-count');
            console.log('Online count found:', !!onlineCount);
            if (onlineCount) {
                onlineCount.textContent = 'Online';
                console.log('Online count updated');
            }
            
           // Load existing messages for this friend
           const chatMessages = chatSidebar.querySelector('.chat-messages');
           console.log('Chat messages found:', !!chatMessages);
           if (chatMessages) {
               loadChatHistory(friendName, chatMessages);
               console.log('Chat history loaded');
           }
            
           // Update the chat input placeholder and add send functionality
           const chatInputContainer = chatSidebar.querySelector('.chat-input');
           const chatInput = chatSidebar.querySelector('.message-input');
           const sendBtn = chatSidebar.querySelector('.send-button');
           
           console.log('Chat elements found:', {
               container: !!chatInputContainer,
               input: !!chatInput,
               button: !!sendBtn
           });
           
           if (chatInput) {
               chatInput.placeholder = 'Type a message to ' + friendName + '...';
               console.log('Chat input placeholder updated');
               
               // Remove any existing event listeners
               chatInput.onkeypress = null;
               
               // Add enter key functionality
               chatInput.onkeypress = function(e) {
                   if (e.key === 'Enter') {
                       sendMessage(friendName, friendInitial);
                   }
               };
               
               console.log('Enter key functionality added');
           }
           
           if (sendBtn) {
               // Remove any existing event listeners
               sendBtn.onclick = null;
               
               // Add new send functionality
               sendBtn.onclick = function() {
                   sendMessage(friendName, friendInitial);
               };
               
               // Update button icon to send icon
               sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i>';
               
               console.log('Send button functionality added');
           }
           
           console.log('=== PERSONAL CHAT SETUP COMPLETE ===');
        }
        
        // Load chat history for a friend
        function loadChatHistory(friendName, chatMessages) {
            const chatKey = `chat_${friendName.replace(/\s+/g, '_').toLowerCase()}`;
            const savedMessages = localStorage.getItem(chatKey);
            
            if (savedMessages) {
                try {
                    const messages = JSON.parse(savedMessages);
                    chatMessages.innerHTML = '';
                    
                    messages.forEach(msg => {
                        const messageElement = document.createElement('div');
                        messageElement.className = 'chat-message';
                        messageElement.innerHTML = `
                            <div class="message-avatar">${msg.sender === 'You' ? 'Y' : msg.avatar}</div>
                            <div class="message-content">
                                <div class="message-header">
                                    <span class="message-user">${msg.sender}</span>
                                    <span class="message-time">${msg.time}</span>
                                </div>
                                <div class="message-text">${msg.text}</div>
                            </div>
                        `;
                        chatMessages.appendChild(messageElement);
                    });
                    
                    // Scroll to bottom
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    console.log('Loaded', messages.length, 'messages for', friendName);
                } catch (e) {
                    console.error('Error loading chat history:', e);
                    chatMessages.innerHTML = '';
                }
            } else {
                chatMessages.innerHTML = '';
                console.log('No chat history found for', friendName);
            }
        }
        
        // Save message to localStorage
        function saveMessage(friendName, sender, messageText, timeString, avatar) {
            const chatKey = `chat_${friendName.replace(/\s+/g, '_').toLowerCase()}`;
            const savedMessages = localStorage.getItem(chatKey);
            
            let messages = [];
            if (savedMessages) {
                try {
                    messages = JSON.parse(savedMessages);
                } catch (e) {
                    console.error('Error parsing saved messages:', e);
                    messages = [];
                }
            }
            
            // Add new message
            messages.push({
                sender: sender,
                text: messageText,
                time: timeString,
                avatar: avatar,
                timestamp: Date.now()
            });
            
            // Save back to localStorage
            localStorage.setItem(chatKey, JSON.stringify(messages));
            console.log('Message saved for', friendName);
        }
        
        // Send message function
        function sendMessage(friendName, friendInitial) {
            const chatInput = document.querySelector('.message-input');
            const chatMessages = document.querySelector('.chat-messages');
            
            if (!chatInput || !chatMessages) {
                console.error('Chat elements not found:', {
                    input: !!chatInput,
                    messages: !!chatMessages
                });
                return;
            }
            
            const messageText = chatInput.value.trim();
            if (!messageText) {
                console.log('No message to send');
                return;
            }
            
            console.log('Sending message:', messageText);
            
            // Get current time
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            // Create message element
            const messageElement = document.createElement('div');
            messageElement.className = 'chat-message';
            messageElement.innerHTML = `
                <div class="message-avatar">Y</div>
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-user">You</span>
                        <span class="message-time">${timeString}</span>
                    </div>
                    <div class="message-text">${messageText}</div>
                </div>
            `;
            
            // Add message to chat
            chatMessages.appendChild(messageElement);
            
            // Save message to localStorage
            saveMessage(friendName, 'You', messageText, timeString, 'Y');
            
            // Clear input
            chatInput.value = '';
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            console.log('Message sent and saved successfully');
        }
        
        // Send/Unsend friend request function
        function sendFriendRequest(button, friendName) {
            const buttonText = button.innerHTML.trim();
            
            // Check if button is in "Add" state
            if (buttonText.includes('Add')) {
                // Send friend request
                button.innerHTML = '<i class="fas fa-check"></i> Sent';
                button.style.background = '#6c757d';
                button.style.border = '1px solid #6c757d';
                button.style.color = 'white';
                
                // Store the request in localStorage
                const requests = JSON.parse(localStorage.getItem('friendRequests') || '[]');
                requests.push({
                    friendName: friendName,
                    timestamp: Date.now(),
                    status: 'sent'
                });
                localStorage.setItem('friendRequests', JSON.stringify(requests));
                
                console.log('Friend request sent to', friendName);
                
            } else if (buttonText.includes('Sent')) {
                // Unsend friend request
                button.innerHTML = '<i class="fas fa-user-plus"></i> Add';
                button.style.background = '';
                button.style.border = '';
                button.style.color = '';
                
                // Remove the request from localStorage
                const requests = JSON.parse(localStorage.getItem('friendRequests') || '[]');
                const updatedRequests = requests.filter(req => req.friendName !== friendName);
                localStorage.setItem('friendRequests', JSON.stringify(updatedRequests));
                
                console.log('Friend request unsent to', friendName);
            }
        }
        
        // Profile Modal Functions
        function showProfileModal(name, initial, status, level, balance, games, winRate, friends) {
            console.log('Opening profile modal for:', name);
            
            // Get modal elements
            const overlay = document.getElementById('profileModalOverlay');
            const modalName = document.getElementById('profileModalName');
            const modalAvatar = document.getElementById('profileModalAvatar');
            const modalStatus = document.getElementById('profileModalStatusText');
            const modalStatusDot = document.getElementById('profileModalStatusDot');
            const modalLevel = document.getElementById('profileModalLevel');
            const modalBalance = document.getElementById('profileModalBalance');
            const modalGames = document.getElementById('profileModalGames');
            const modalWinRate = document.getElementById('profileModalWinRate');
            
            // Update modal content
            modalName.textContent = name;
            modalAvatar.textContent = initial;
            modalStatus.textContent = status;
            modalLevel.textContent = level;
            modalBalance.textContent = '$' + balance.toLocaleString();
            modalGames.textContent = games.toLocaleString();
            modalWinRate.textContent = winRate + '%';
            
            // Update status dot
            if (status === 'Online') {
                modalStatusDot.classList.remove('offline');
                modalStatusDot.style.background = '#27ae60';
            } else {
                modalStatusDot.classList.add('offline');
                modalStatusDot.style.background = '#95a5a6';
            }
            
            // Show modal
            overlay.style.display = 'flex';
            
            // Store current profile for message function
            window.currentProfile = { name, initial };
            
            console.log('Profile modal opened successfully');
        }
        
        function closeProfileModal() {
            const overlay = document.getElementById('profileModalOverlay');
            overlay.style.display = 'none';
            console.log('Profile modal closed');
        }
        
        function messageFromProfile() {
            if (window.currentProfile) {
                closeProfileModal();
                openPersonalChat(window.currentProfile.name, window.currentProfile.initial);
            }
        }
        
        // Close modal when clicking overlay
        document.addEventListener('click', function(e) {
            const overlay = document.getElementById('profileModalOverlay');
            if (e.target === overlay) {
                closeProfileModal();
            }
        });
    </script>
    
    <!-- Mobile Bottom Navigation -->
    <nav class="mobile-bottom-nav" id="mobileBottomNav">
        <div class="nav-items">
            <a href="#" class="nav-item active" onclick="showHome(); closeMobileMenu(); updateMobileNav('home'); return false;">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a href="#" class="nav-item" onclick="showFavorites(); closeMobileMenu(); updateMobileNav('favorites'); return false;">
                <i class="fas fa-star"></i>
                <span>Favorites</span>
            </a>
            <a href="#" class="nav-item" onclick="showCommunity(); closeMobileMenu(); updateMobileNav('community'); return false;">
                <i class="fas fa-users"></i>
                <span>Community</span>
            </a>
            <a href="#" class="nav-item" onclick="showProfile(); closeMobileMenu(); updateMobileNav('profile'); return false;">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </a>
        </div>
    </nav>
    
    <!-- Mobile Menu JavaScript -->
    <script>
        // Mobile menu toggle functionality
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        
        function openMobileMenu() {
            sidebar.classList.add('mobile-open');
            sidebarOverlay.classList.add('active');
            mobileMenuToggle.classList.add('active');
            mobileMenuToggle.innerHTML = '<i class="fas fa-times"></i>';
            document.body.style.overflow = 'hidden';
        }
        
        function closeMobileMenu() {
            sidebar.classList.remove('mobile-open');
            sidebarOverlay.classList.remove('active');
            mobileMenuToggle.classList.remove('active');
            mobileMenuToggle.innerHTML = '<i class="fas fa-bars"></i>';
            document.body.style.overflow = '';
        }
        
        if (mobileMenuToggle) {
            mobileMenuToggle.addEventListener('click', function(e) {
                e.stopPropagation();
                if (sidebar.classList.contains('mobile-open')) {
                    closeMobileMenu();
                } else {
                    openMobileMenu();
                }
            });
        }
        
        // Make functions globally available
        window.openMobileMenu = openMobileMenu;
        window.closeMobileMenu = closeMobileMenu;
        window.updateMobileNav = updateMobileNav;
        
        if (sidebarOverlay) {
            sidebarOverlay.addEventListener('click', closeMobileMenu);
        }
        
        // Close mobile menu when clicking a nav item in sidebar
        const sidebarNavItems = document.querySelectorAll('.sidebar .nav-item');
        sidebarNavItems.forEach(item => {
            item.addEventListener('click', function() {
                setTimeout(closeMobileMenu, 300);
            });
        });
        
        // Update mobile bottom nav active state
        function updateMobileNav(section) {
            const navItems = document.querySelectorAll('.mobile-bottom-nav .nav-item');
            navItems.forEach(item => {
                item.classList.remove('active');
            });
            
            const sectionMap = {
                'home': 0,
                'favorites': 1,
                'community': 2,
                'profile': 3
            };
            
            if (sectionMap[section] !== undefined) {
                navItems[sectionMap[section]].classList.add('active');
            }
        }
        
        // Update active state when using desktop navigation
        const originalShowHome = window.showHome;
        const originalShowFavorites = window.showFavorites;
        const originalShowCommunity = window.showCommunity;
        const originalShowProfile = window.showProfile;
        
        if (typeof originalShowHome === 'function') {
            window.showHome = function() {
                originalShowHome();
                updateMobileNav('home');
            };
        }
        
        if (typeof originalShowFavorites === 'function') {
            window.showFavorites = function() {
                originalShowFavorites();
                updateMobileNav('favorites');
            };
        }
        
        if (typeof originalShowCommunity === 'function') {
            window.showCommunity = function() {
                originalShowCommunity();
                updateMobileNav('community');
            };
        }
        
        if (typeof originalShowProfile === 'function') {
            window.showProfile = function() {
                originalShowProfile();
                updateMobileNav('profile');
            };
        }
        
        // Close mobile menu on window resize (when switching to desktop)
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                closeMobileMenu();
            }
        });
        
        // Prevent body scroll when mobile menu is open
        let lastScrollY = 0;
        window.addEventListener('touchmove', function(e) {
            if (sidebar.classList.contains('mobile-open')) {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
    </body>
</html>
